# EZ-Video-Chatbot-App

適用例：家電量販店の商品紹介アシスタント

![image](https://github.com/user-attachments/assets/4b137d30-c26a-4d00-a849-184e4f723893)

## アプリ概要

「イージービデオチャットボット」アプリ
- これは、アバターをキャプチャした動画や、人間が話している様子を撮影した動画を使ったチャットボットのサンプルアプリです。
- 「待機中（口を閉じている）」「発話中（口を動かしている）」「対話開始（お辞儀、挨拶など）」の動画を用意するだけで、簡単にそのアバターや人間がAI対話アシスタントになります。
- 動画を用意する際は、ループ再生してもできるだけ最初と最後のつながりが自然になるように考慮してください。アシスタントの待機中または発話中の時間が長かった場合、その分動画がループ再生されるためです。

## 特徴
- 会話状況に応じて再生する動画を切り替えることで、疑似的に動画のアバター／人間がリアルタイムに話しているように見せることができる、「なんちゃって」対話アプリです。
- フリーの音声認識ライブラリ、フリーの音声合成ソフトを使い、リアルタイムに対話を行うことができます。
- 高性能なGPUを必要とする3DCGエンジンは不要です。より快適な動作のためにGeForce RTXシリーズ等のディスクリートGPUがあるとより良いですが、CPUのみのPCでも最低限動作するように設計しています。

## 制限
- Tkinterを利用し、GUI部品の画像を高速に再描画することで動画再生を実現しているため、CPUのスペックにより再生の滑らかさが異なります。
- 音声認識、音声合成にはローカルのモデルを利用しますので、アプリを実行するPCのスペックによって反応が遅くなることがあります。
- 対話画面は1920x1080で固定しています。画面のスケーリング設定によって対話画面が拡大され、ディスプレイからはみ出すことがあります。その場合、OSの表示倍率の設定を100%に変更してください。
- フルHD未満のディスプレイには非対応です。

##  動作確認済環境(ノート／デスクトップ)
- OS：Windows 11 24H2
- CPU：intel Core i7-8650U、11370H、AMD Ryzen 7 7840U、5700X
- GPU：NVIDIA GeForce GTX 1050 Laptop GPU、RTX 3050Ti Laptop GPU、RTX 3090

### 動画再生の滑らかさ（目安）
- intel Core i7-8650U（ノートPC向け）：△
- intel Core i7-11370H（ノートPC向け）：○
- AMD Ryzen 7 7840U（ノートPC向け）：◎
- AMD Ryzen 7 5700X（デスクトップPC向け）：◎

- 第12世代以降のintel Core i7～、Core 7～、または同等スペックのRyzenなど、中堅～上位スペックのデスクトップCPUで快適に動画再生が動作します。上位のCPUであっても、ノートPCの場合動画再生がもたつくことがあります。
- ディスクリートGPUを搭載したPCを利用すると音声認識、音声合成の処理が早くなります。（音声認識をGPUに対応するためには、CUDAのセットアップ、CUDAに対応したライブラリのインストールが必要です）


## アプリ実行手順

以下のソフトウェアのインストールが必要です。
- ffmpeg：mp4動画の再生（ffmpeg.exeのあるパスを環境変数PATHに追加してください）
- VOICEVOX：日本語の音声合成（可能な場合は、設定から合成エンジンにGPUを指定してください）
- OpenAI API：対話生成に必要です。GPT-4o（その他のモデルを指定する場合、`chat.py`を変更）が利用可能なAPIキーを取得してください。

- CUDAが利用可能なPCの場合、pytorchの公式サイトからCUDAに対応したPyTorchをインストールしておくと動作が快適になります。
https://pytorch.org/get-started/locally/

- アプリの実行に必要なモジュールをインストールします。
```sh
pip install -r requirements.txt
```
- constants.pyを編集し、APIキーを貼り付けて保存します。
```python
class Constants:
    OPENAI_API_KEY = "sk-XXX"
```

- 以下のコマンドを実行することでGUI画面が起動します。
```sh
python3 main.py
```

## 使い方

- 画面起動後、画面下の指示にしたがって、音声入力デバイスに向かって発話してください。デフォルトでは、OS設定の規定入力デバイスです（PC内蔵マイク等）。
- 使いたいデバイスを固定するためにはtts.pyを編集してください。


## カスタマイズ

### LLMのプロンプト
`prompts/system_primpt.txt`：システムプロンプト

### RAGデータ
`rag/`フォルダ内に参照するテキストファイルを格納してください

### UI関連の設定
`constants.py`：動画の指定、チャットの背景色・文字色や、会話終了キーワードなどの固定値

## 処理シーケンス

![image](https://github.com/user-attachments/assets/1dcb321d-f4c0-4ec8-a0e1-fa3b30664dae)


